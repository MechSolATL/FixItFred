@page
@model Pages.Technician.LeaderboardViewModel
@inject Services.TechnicianLeaderboardService LeaderboardService
@{
    ViewData["Title"] = "Technician Leaderboard";
    Layout = "/Pages/Shared/_Layout.cshtml";
    var leaderboard = LeaderboardService.GetLeaderboard();
    // Sprint 84.5.1 — Razor Rename: Leaderboard.cshtml to LeaderboardView.cshtml (encoding fix)
    string GetTierColor(int tier)
    {
        return tier switch
        {
            >= 4 => "platinum",
            3 => "gold",
            2 => "silver",
            1 => "bronze",
            _ => "gray"
        };
    }
    string GetTierName(int tier)
    {
        return tier switch
        {
            >= 4 => "Platinum",
            3 => "Gold",
            2 => "Silver",
            1 => "Bronze",
            _ => "Unranked"
        };
    }
}
<!-- Sprint 84.5.1 — Leaderboard Expansion & Responsive Layout -->
<link rel="stylesheet" href="~/css/leaderboard.css" />
<div class="container mx-auto px-2 py-4">
    <h2 class="mb-4">Technician Leaderboard</h2>
    <div class="leaderboard-grid leaderboard-scroll">
        @for (int i = 0; i < leaderboard.Count; i++)
        {
            var entry = leaderboard[i];
            var tierColor = GetTierColor(entry.TierLevel);
            var tierName = GetTierName(entry.TierLevel);
            var isTop3 = i < 3;
            var delta = entry.RankChangeDelta;
            var deltaIcon = delta > 0 ? "??" : delta < 0 ? "??" : "";
            var deltaClass = delta > 0 ? "text-success" : delta < 0 ? "text-danger" : "text-muted";
            var heat = entry.RivalryHeatLevel;
            var collapsedClass = (i >= 5) ? "collapsed" : "";
        <div class="card leaderboard-card shadow p-3 flex flex-col items-center border-2 border-@tierColor @collapsedClass" onclick="toggleLeaderboardCard(this)">
            <div class="flex items-center gap-2 mb-2">
                <span class="badge bg-@tierColor text-white px-2 py-1" title="@tierName">@tierName</span>
                @if (isTop3)
                {
                    <span title="Top 3"><i class="bi bi-trophy-fill text-warning"></i></span>
                }
            </div>
            <div class="text-xl font-bold">@entry.Name</div>
            <div class="text-sm text-muted mb-1">@entry.City</div>
            <div class="flex items-center gap-2 mb-1">
                <span class="fw-bold">Rank #@(i + 1)</span>
                <span class="@deltaClass">@deltaIcon @Math.Abs(delta)</span>
            </div>
            <div class="flex items-center gap-2 mb-1">
                <span class="fw-bold">Points Today:</span>
                <span class="text-success">+@entry.PointsGainedToday</span>
            </div>
            @if (heat > 1)
            {
                <div class="flex items-center gap-1 mb-1">
                    <span class="fw-bold text-danger">?? Rival Heat</span>
                    <span class="badge bg-danger">@heat</span>
                </div>
            }
            <div class="flex items-center gap-2 mt-2">
                <span class="fw-bold">Total Points:</span>
                <span>@entry.TotalPoints</span>
            </div>
        </div>
        }
    </div>
</div>
@section Scripts {
<script>
// Sprint 84.5.1 — Responsive Layout: Card expand/collapse for mobile
function toggleLeaderboardCard(card) {
    card.classList.toggle('collapsed');
}
document.addEventListener('DOMContentLoaded', function() {
    // Auto-collapse cards beyond top 5 on mobile
    if (window.innerWidth < 600) {
        document.querySelectorAll('.leaderboard-card').forEach(function(card, idx) {
            if (idx >= 5) card.classList.add('collapsed');
        });
    }
});
</script>
}
<!-- End Sprint 84.5.1 — Responsive Layout -->
