@page
@using MVP_Core.Models.Mobile
@inject MVP_Core.Services.Admin.DispatcherService DispatcherService
@{
    int techId = 0;
    int.TryParse(Request.Query["techId"], out techId);
    var job = DispatcherService.GetNextJobForTechnician(techId);
    ViewData["Title"] = "My Next Job";
}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        .mobile-panel { max-width: 420px; margin: 0 auto; padding: 1em; }
        .job-card { border-radius: 12px; box-shadow: 0 2px 8px #ccc; padding: 1em; background: #fff; }
        .job-label { font-weight: bold; color: #555; }
        .ping-btn { width: 100%; font-size: 1.2em; margin-top: 1em; }
        .note-block { background: #f8f9fa; border-radius: 8px; padding: 0.7em; margin-top: 1em; }
        @media (max-width: 600px) { .mobile-panel { padding: 0.3em; } .job-card { padding: 0.5em; } }
    </style>
</head>
<body>
<div class="mobile-panel">
    <h3 class="mb-3">Technician Mobile Panel</h3>
    @if (job == null)
    {
        <div class="alert alert-warning">No active job assigned.</div>
    }
    else
    {
        <div class="job-card mb-3">
            <div class="mb-2 job-label">Technician:</div>
            <div class="mb-2">@job.TechnicianName</div>
            <div class="mb-2 job-label">Next Job:</div>
            <div class="mb-2">@job.JobSummary</div>
            <div class="mb-2 job-label">ETA:</div>
            <div class="mb-2">@job.ETA.ToLocalTime():t</div>
            <div class="mb-2 job-label">Address:</div>
            <div class="mb-2"><a href="https://maps.google.com/?q=@job.Address" target="_blank">@job.Address</a></div>
            <div class="mb-2 job-label">Last Dispatcher Note:</div>
            <div class="note-block">@job.DispatcherNote</div>
            <div class="mb-2 job-label">Last Ping:</div>
            <div class="mb-2">@job.LastPing.ToLocalTime():t</div>
            <form method="post">
                <input type="hidden" name="techId" value="@job.TechnicianId" />
                <button type="submit" class="btn btn-success ping-btn">Ping Dispatcher (I'm Ready)</button>
            </form>
            @if (TempData["PingStatus"] != null)
            {
                <div class="alert alert-success mt-2">@TempData["PingStatus"]</div>
            }
        </div>
    }
    <div class="mt-4 text-center">
        <span class="text-muted">Scan QR to login (coming soon)</span>
    </div>
</div>
</body>
</html>
