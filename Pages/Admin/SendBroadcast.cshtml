@page
@using MVP_Core.Models.Admin
@inject MVP_Core.Services.Admin.DispatcherService DispatcherService
@{
    ViewData["Title"] = "Send Broadcast Alert";
    string message = "";
    string expires = "";
    if (IsPost)
    {
        message = Request.Form["Message"];
        expires = Request.Form["ExpiresAt"];
        DateTime? expiresAt = null;
        if (DateTime.TryParse(expires, out var dt)) expiresAt = dt;
        if (!string.IsNullOrWhiteSpace(message))
        {
            DispatcherService.AddBroadcast(new DispatcherBroadcast
            {
                Message = message,
                IssuedAt = DateTime.UtcNow,
                IssuedBy = User?.Identity?.Name ?? "system",
                ExpiresAt = expiresAt
            });
            ViewData["Success"] = "Broadcast sent.";
        }
        else
        {
            ViewData["Error"] = "Message is required.";
        }
    }
}
<h2 class="mb-4">Send Broadcast Alert</h2>
@if (ViewData["Success"] != null)
{
    <div class="alert alert-success">@ViewData["Success"]</div>
}
@if (ViewData["Error"] != null)
{
    <div class="alert alert-danger">@ViewData["Error"]</div>
}
<form method="post" class="mb-4">
    <div class="mb-3">
        <label class="form-label">Message</label>
        <textarea name="Message" class="form-control" rows="3" required></textarea>
    </div>
    <div class="mb-3">
        <label class="form-label">Expires At (optional)</label>
        <input type="datetime-local" name="ExpiresAt" class="form-control" />
    </div>
    <button type="submit" class="btn btn-danger">Send Broadcast</button>
</form>
