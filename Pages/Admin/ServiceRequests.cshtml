@page
@model MVP_Core.Pages.Admin.ServiceRequestsModel
@{
    ViewData["Title"] = "Service Requests Dashboard";
}

<h1 class="text-2xl font-bold mb-6" role="heading" aria-level="1">
    <span aria-hidden="true">📋</span> Service Requests Dashboard
</h1>

<!-- Search Bar -->
<form method="get" class="mb-6 flex items-center space-x-4">
    <input type="text" name="SearchTerm" value="@Model.SearchTerm" placeholder="Search by Phone, Email, Address"
           class="border px-4 py-2 rounded w-1/3" aria-label="Search Service Requests" />
    <button type="submit" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded shadow">
        <span aria-hidden="true">🔍</span> Search
    </button>
</form>

@if (!Model.ServiceRequests.Any())
{
    <div class="p-4 text-red-600" role="alert">
        No service requests found.
    </div>
}
else
{
    <table class="table-auto w-full border-collapse border border-gray-300">
        <caption class="text-lg font-semibold mb-2 text-left">Service Requests</caption>
        <thead class="bg-gray-100">
            <tr>
                <th scope="col" class="border border-gray-300 px-4 py-2">Service</th>
                <th scope="col" class="border border-gray-300 px-4 py-2">Phone</th>
                <th scope="col" class="border border-gray-300 px-4 py-2">Email</th>
                <th scope="col" class="border border-gray-300 px-4 py-2">Address</th>
                <th scope="col" class="border border-gray-300 px-4 py-2">Status</th>
                <th scope="col" class="border border-gray-300 px-4 py-2">Submitted</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var request in Model.ServiceRequests)
            {
                <tr class="hover:bg-gray-50">
                    <td class="border border-gray-300 px-4 py-2">@request.ServiceType</td>
                    <td class="border border-gray-300 px-4 py-2">@request.Phone</td>
                    <td class="border border-gray-300 px-4 py-2">@request.Email</td>
                    <td class="border border-gray-300 px-4 py-2">@request.Address</td>

                    <td class="border border-gray-300 px-4 py-2">
                        <form method="post" asp-page-handler="UpdateStatus" class="flex items-center space-x-2">
                            @Html.AntiForgeryToken()
                            <input type="hidden" name="RequestId" value="@request.Id" />
                            <select name="NewStatus" class="border px-2 py-1 rounded">
                                <option value="Pending" selected="@(request.Status == "Pending")">Pending</option>
                                <option value="In Progress" selected="@(request.Status == "In Progress")">In Progress</option>
                                <option value="Completed" selected="@(request.Status == "Completed")">Completed</option>
                                <option value="Cancelled" selected="@(request.Status == "Cancelled")">Cancelled</option>
                            </select>
                            <button type="submit" class="px-2 py-1 bg-green-500 hover:bg-green-600 text-white rounded text-sm">
                                Save
                            </button>
                        </form>
                    </td>

                    <td class="border border-gray-300 px-4 py-2">@request.CreatedAt.ToString("yyyy-MM-dd HH:mm")</td>
                </tr>
            }
        </tbody>
    </table>
}
