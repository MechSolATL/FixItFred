@page
@model Pages.Admin.ServiceRequestsModel
@{
    ViewData["Title"] = "Service Requests";
}

<h2 class="text-xl font-semibold mb-4">Service Requests</h2>

<form method="get" class="flex flex-wrap items-center gap-4 mb-4">
    <div>
        <label class="block text-sm font-medium mb-1" for="StatusFilter">Status:</label>
        <select id="StatusFilter" name="StatusFilter" class="border rounded px-2 py-1" onchange="this.form.submit()">
            <option value="">All</option>
            @foreach (var status in new[] { "Pending", "In Progress", "Completed" })
            {
                <option value="@status" selected="@(Model.StatusFilter == status)">
                    @status
                </option>
            }
        </select>
    </div>
    <div>
        <label class="block text-sm font-medium mb-1" for="ServiceTypeFilter">Service Type:</label>
        <select id="ServiceTypeFilter" name="ServiceTypeFilter" class="border rounded px-2 py-1" onchange="this.form.submit()">
            <option value="">All</option>
            @foreach (var type in new[] { "Plumbing", "Heating", "Air Conditioning", "Water Filtration" })
            {
                <option value="@type" selected="@(Model.ServiceTypeFilter == type)">
                    @type
                </option>
            }
        </select>
    </div>
</form>

<table class="table-auto w-full border">
    <thead>
        <tr class="bg-gray-100">
            <th class="p-2 border">Customer Name</th>
            <th class="p-2 border">Service Type</th>
            <th class="p-2 border">Request Time</th>
            <th class="p-2 border">Status</th>
            <th class="p-2 border">Commission</th> <!-- Sprint 26.6 -->
            <th class="p-2 border">Financing</th> <!-- Sprint 26.6 -->
        </tr>
    </thead>
    <tbody>
        @foreach (var req in Model.Requests)
        {
            <tr>
                <td class="border px-4 py-2">@req.CustomerName</td>
                <td class="border px-4 py-2">@req.ServiceType</td>
                <td class="border px-4 py-2">@req.CreatedAt.ToLocalTime().ToString("g")</td>
                <td class="border px-4 py-2">@req.Status</td>
                <td class="border px-4 py-2">@(req.TechnicianCommission?.ToString("C") ?? "-")</td>
                <td class="border px-4 py-2">@(req.FinancingAmount.HasValue ? $"{req.FinancingAmount.Value:C} @ {req.FinancingAPR}%" : "-")</td>
            </tr>
        }
    </tbody>
</table>

