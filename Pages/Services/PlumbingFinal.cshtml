@page
@model MVP_Core.Pages.Services.PlumbingFinalModel
@{
    ViewData["Title"] = "Review Your Plumbing Request";
}

<h1 class="text-3xl font-bold mb-6" role="heading" aria-level="1">
    <span aria-hidden="true">🚿</span> Final Step: Confirm Your Request
</h1>

@if (TempData["Expired"] != null)
{
    <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-6" role="alert">
        <span aria-hidden="true">⚠️</span> Your session has expired due to inactivity. Please restart your request.
    </div>
}

@if (Model.SessionData != null)
{
    var firstName = Model.SessionData.CustomerName?.Split(' ')[0] ?? "Customer";

    <div class="bg-white p-6 rounded shadow-md mb-8">
        <h2 class="text-xl font-semibold mb-4">Hi @firstName <span aria-hidden="true">👋</span></h2>

        <p class="text-gray-700 mb-4">
            Here's a quick look at your service request before we lock it in!
            Please double-check your information — we like getting things right the first time (and so do you!). <span aria-hidden="true">😎</span>
        </p>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
            <div>
                <strong>Full Name:</strong><br /> @Model.SessionData.CustomerName
            </div>
            <div>
                <strong>Phone:</strong><br /> @Model.SessionData.PhoneNumber
            </div>
            <div>
                <strong>Email:</strong><br /> @Model.SessionData.Email
            </div>
            <div>
                <strong>Service Address:</strong><br /> @Model.SessionData.Address
            </div>
        </div>

        <h3 class="text-lg font-semibold mb-3">
            <span aria-hidden="true">📝</span> Your Service Details:
        </h3>

        <ul class="list-disc list-inside space-y-2">
            @foreach (var answer in Model.SessionData.Answers)
            {
                <li>
                    <strong>Question ID @answer.Key:</strong> @answer.Value.Answer
                    <div class="text-sm text-gray-500 ml-6">
                        Answered on @answer.Value.AnsweredAt.ToString("MMMM dd, yyyy - hh:mm tt")
                    </div>
                </li>
            }
        </ul>

        <partial name="~/Pages/Shared/Partials/_SupportBox.cshtml" />
    </div>

    <form method="post" asp-page-handler="Submit" class="flex justify-center mt-6">
        @Html.AntiForgeryToken()
        <button type="submit" class="px-8 py-3 bg-green-600 hover:bg-green-700 text-white text-lg font-bold rounded-full shadow">
            <span aria-hidden="true">✅</span> Confirm and Submit
        </button>
    </form>
}
else
{
    <div class="text-center text-red-600 font-bold" role="alert">
        No active session found. Please restart your request.
    </div>
}
