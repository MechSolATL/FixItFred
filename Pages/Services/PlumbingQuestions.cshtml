@page
@model MVP_Core.Pages.Services.PlumbingQuestionsModel
@{
    ViewData["Title"] = "Request Plumbing Services";
    Layout = "~/Pages/Shared/_Layout.cshtml";
}

<div class="service-container mt-4">
    <h1 class="text-primary mb-4">Request Plumbing Services</h1>

    @if (Model.Questions.Any())
    {
        <form method="post" asp-page-handler="SubmitAnswers">
            <div id="progressBarContainer" class="progress mb-4" style="height: 20px;">
                <div id="progressBar" class="progress-bar bg-success" role="progressbar" style="width: 0%;" aria-valuemin="0" aria-valuemax="100"></div>
            </div>

            @for (int i = 0; i < Model.Questions.Count; i++)
            {
                var question = Model.Questions[i];
                <div class="mb-5 p-4 bg-white rounded shadow-sm question-block" data-step="@i">
                    <label class="font-weight-bold h5">@question.Text</label>

                    <div class="mt-3">
                        @if (question.InputType.ToLower() == "radio")
                        {
                            foreach (var option in question.Options)
                            {
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="Responses[@question.Id]" id="q@question.Id-option@option.Id" value="@option.OptionValue" required>
                                    <label class="form-check-label" for="q@question.Id-option@option.Id">
                                        @option.OptionText
                                    </label>
                                </div>
                            }
                        }
                        else if (question.InputType.ToLower() == "text")
                        {
                            <input class="form-control mt-2" type="text" name="Responses[@question.Id]" placeholder="Enter your answer..." required />
                        }
                        else
                        {
                            <input class="form-control mt-2" type="text" name="Responses[@question.Id]" placeholder="Answer..." required />
                        }
                    </div>
                </div>
            }

            <button type="submit" class="btn btn-primary btn-lg">Submit My Request</button>
        </form>
    }
    else
    {
        <div class="alert alert-warning">
            No questions available at the moment. Please try again later!
        </div>
    }
</div>

@section Scripts {
    <script>
        // JavaScript for Dynamic Progress Bar
        document.addEventListener('DOMContentLoaded', function () {
            const steps = document.querySelectorAll('.question-block');
            const progressBar = document.getElementById('progressBar');
            let totalSteps = steps.length;

            function updateProgress(currentIndex) {
                let percent = ((currentIndex + 1) / totalSteps) * 100;
                progressBar.style.width = percent + "%";
                progressBar.setAttribute('aria-valuenow', percent);
            }

            let inputs = document.querySelectorAll('.question-block input');
            inputs.forEach(input => {
                input.addEventListener('change', function () {
                    let answeredSteps = Array.from(steps).filter(step => {
                        return step.querySelector('input:checked, input[type="text"]').value !== "";
                    }).length;
                    updateProgress(answeredSteps - 1);
                });
            });
        });
    </script>
}
